version: '3.8'

services:
  otomoto-db:
    image: postgres:latest
    container_name: otomoto-db
    environment:
      POSTGRES_PASSWORD: root
      POSTGRES_USER: postgres
      POSTGRES_DB: otomoto_db
      PGDATA: /var/lib/postgresql/data/pgdata
    restart: always
    ports:
      - 5432
    volumes:
      - oto-moto-volumes:/var/lib/postgresql/data/pgdata
    networks:
      - otomoto-network

  otomoto-service:
    image: otomoto-service
    build:
      context: ./otomoto-service
      dockerfile: Dockerfile
    restart: always
    depends_on:
      - eureka-server
      - otomoto-db
    ports:
      - 8080
    volumes:
      - /data/otomoto-service
    networks:
      - otomoto-network

  otomoto-client:
    image: otomoto-client
    build:
      context: ./otomoto-client
      dockerfile: Dockerfile
    restart: always
    depends_on:
      - eureka-server
    links:
      - otomoto-service
    ports:
      - 8081
    volumes:
      - /data/otomoto-client
    networks:
      - otomoto-network

  currency-api:
    image: currency-api
    build:
      context: ./currency-api
      dockerfile: Dockerfile
    restart: always
    depends_on:
      - eureka-server
    ports:
      - 8082
    volumes:
      - /data/currency-api
    networks:
      - otomoto-network

  location-api:
    image: location-api
    build:
      context: ./location-api
      dockerfile: Dockerfile
    restart: always
    depends_on:
      - eureka-server
      - otomoto-db
    ports:
      - 8083
    volumes:
      - /data/location-api
    networks:
      - otomoto-network

  data-importer:
    image: data-importer
    build:
      context: ./data-importer
      dockerfile: Dockerfile
    restart: always
    depends_on:
      - eureka-server
      - otomoto-db
    ports:
      - 8084
    volumes:
      - /data/data-importer
    networks:
      - otomoto-network

  api-gateway:
    image: api-gateway
    build:
      context: ./api-gateway
      dockerfile: Dockerfile
    restart: always
    ports:
      - 8085:8085
    depends_on:
      - currency-api
      - data-importer
      - eureka-server
      - location-api
      - otomoto-service
      - otomoto-client
    networks:
      - otomoto-network

  eureka-server:
    image: eureka-server
    build:
      context: ./eureka-server
      dockerfile: Dockerfile
    restart: always
    ports:
      - 8761:8761
    networks:
      - otomoto-network

networks:
  otomoto-network:
volumes:
  oto-moto-volumes: { }